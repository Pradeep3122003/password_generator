#!/bin/bash

# Path to your compressed wordlist
WORDLIST="./source/words.txt.gz"

# default word count
WORDS=4

# if user passed length argument
if [[ "$1" =~ ^[0-9]+$ ]]; then
  MAXLEN="$1"
else
  MAXLEN=0
fi

# Read and decompress the dictionary safely
if [[ -f "$WORDLIST" ]]; then
  wordlist=$(gzip -dc "$WORDLIST")
else
  echo "Error: $WORDLIST not found"
  exit 1
fi

# Convert to array
mapfile -t WORDS_ARRAY <<< "$wordlist"

pick_word() {
  printf "%s" "${WORDS_ARRAY[$RANDOM % ${#WORDS_ARRAY[@]}]}"
}

pick_number() {
  shuf -i 2-3333 -n 1
}

generate() {
  local pw=""
  local count=$((RANDOM % 6 + 3))   # 3â€“8 segments like Python

  for ((i=0;i<count;i++)); do
    toss=$((RANDOM % 4))
    if [[ $toss -eq 0 || $toss -eq 1 ]]; then
      pw+=$(pick_word)
    else
      pw+=$(pick_number)
    fi
  done

  echo "$pw"
}

# Generate raw password
password=$(generate)

# Trim to maximum length if needed
if [[ $MAXLEN -gt 1 ]]; then
  password="${password:0:MAXLEN}"
fi

echo "password: $password"
